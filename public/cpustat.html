<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Statistics</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .metric { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .value { font-size: 24px; font-weight: bold; }
        .nav { margin: 20px 0; }
        .error { color: red; }
        .loading { color: gray; }
    </style>
</head>
<body>
    <h1>CPU Statistics</h1>
    
    <div class="nav">
        <a href="/">Home</a> | 
        <a href="cpustat">CPU</a> | 
        <a href="memorystat">Memory</a> | 
        <a href="diskstat">Disk</a>
    </div>
    
    <button onclick="fetchData()">Refresh</button>
    <span id="lastUpdated">Last updated: Never</span>
    
    <div id="loading" class="loading">Loading...</div>
    <div id="error" class="error" style="display:none;"></div>
    
    <div id="metrics" style="display:none;">
        <div class="metric">
            <div class="value" id="cpuUsage">--</div>
            <div>CPU Usage (%)</div>
        </div>
        
        <div class="metric">
            <div class="value" id="cpuCount">--</div>
            <div>CPU Cores</div>
        </div>
        
        <div class="metric">
            <div class="value" id="processCount">--</div>
            <div>Active Processes</div>
        </div>
        
        <div class="metric">
            <div class="value" id="cpuModel">--</div>
            <div>CPU Model</div>
        </div>
    </div>

    <script>
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleString()}`;
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
            document.getElementById('metrics').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('metrics').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function showMetrics() {
            document.getElementById('metrics').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function updateMetrics(data) {
            document.getElementById('cpuUsage').textContent = (data.cpu_usage_percent || 0).toFixed(1);
            document.getElementById('cpuCount').textContent = data.cpu_count || '--';
            document.getElementById('processCount').textContent = data.processes_count || '--';
            document.getElementById('cpuModel').textContent = data.cpu_model || 'Unknown';
        }

        async function fetchData() {
            showLoading();
            try {
                const response = await fetch('/cpustatjson');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                updateMetrics(data);
                updateLastUpdated();
                showMetrics();
            } catch (error) {
                showError(`Failed to fetch CPU data: ${error.message}`);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchData);
        setInterval(fetchData, 5000);
    </script>
</body>
</html>
