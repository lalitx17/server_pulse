<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Statistics</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .metric { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .value { font-size: 24px; font-weight: bold; }
        .nav { margin: 20px 0; }
        .error { color: red; }
        .loading { color: gray; }
    </style>
</head>
<body>
    <h1>Memory Statistics</h1>
    
    <div class="nav">
        <a href="/">Home</a> | 
        <a href="cpustat">CPU</a> | 
        <a href="memorystat">Memory</a> | 
        <a href="diskstat">Disk</a>
    </div>
    
    <button onclick="fetchData()">Refresh</button>
    <span id="lastUpdated">Last updated: Never</span>
    
    <div id="loading" class="loading">Loading...</div>
    <div id="error" class="error" style="display:none;"></div>
    
    <div id="metrics" style="display:none;">
        <div class="metric">
            <div class="value" id="memoryUsage">--</div>
            <div>Memory Usage (%)</div>
        </div>
        
        <div class="metric">
            <div class="value" id="totalMemory">--</div>
            <div>Total Memory (GB)</div>
        </div>
        
        <div class="metric">
            <div class="value" id="usedMemory">--</div>
            <div>Used Memory (GB)</div>
        </div>
        
        <div class="metric">
            <div class="value" id="freeMemory">--</div>
            <div>Free Memory (GB)</div>
        </div>
        
        <div class="metric">
            <div class="value" id="swapTotal">--</div>
            <div>Swap Total (GB)</div>
        </div>
        
        <div class="metric">
            <div class="value" id="swapFree">--</div>
            <div>Swap Free (GB)</div>
        </div>
    </div>

    <script>
        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleString()}`;
        }

        function showError(message) {
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
            document.getElementById('metrics').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('metrics').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function showMetrics() {
            document.getElementById('metrics').style.display = 'block';
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function updateMetrics(data) {
            const totalMemory = data.total_memory || 0;
            const freeMemory = data.free_memory || 0;
            const usedMemory = totalMemory - freeMemory;
            const memoryUsage = totalMemory > 0 ? ((usedMemory / totalMemory) * 100) : 0;
            
            document.getElementById('memoryUsage').textContent = memoryUsage.toFixed(1);
            document.getElementById('totalMemory').textContent = totalMemory.toFixed(2);
            document.getElementById('usedMemory').textContent = usedMemory.toFixed(2);
            document.getElementById('freeMemory').textContent = freeMemory.toFixed(2);
            document.getElementById('swapTotal').textContent = (data.swap_total || 0).toFixed(2);
            document.getElementById('swapFree').textContent = (data.swap_free || 0).toFixed(2);
        }

        async function fetchData() {
            showLoading();
            try {
                const response = await fetch('/memorystatjson');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                updateMetrics(data);
                updateLastUpdated();
                showMetrics();
            } catch (error) {
                showError(`Failed to fetch memory data: ${error.message}`);
            }
        }

        document.addEventListener('DOMContentLoaded', fetchData);
        setInterval(fetchData, 5000);
    </script>
</body>
</html>
